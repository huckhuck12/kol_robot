# KOL交易信号推送系统

一个自动从KOL平台获取交易信号并推送到钉钉机器人的系统。

## 功能特点

- 📊 **自动抓取**：定时从API获取最新的KOL交易信号
- 🔔 **钉钉推送**：将新的交易信号实时推送到钉钉机器人
- ⏰ **定时任务**：可配置的抓取频率（默认每5分钟）
- 📝 **智能去重**：自动记录已处理的信号，避免重复推送
- 📋 **结构化信号**：提取完整的交易信息（交易对、方向、价格、杠杆等）
- 🔧 **易于配置**：通过配置文件即可调整系统参数

## 技术栈

- **Node.js**：运行环境
- **axios**：HTTP请求库，用于模拟浏览器访问API
- **node-schedule**：定时任务库
- **crypto**：生成钉钉机器人签名

## 项目结构

```
kol_robot/
├── config.js                  # 配置文件
├── package.json               # 项目依赖
├── README.md                  # 项目说明
├── data/
│   └── processedSignals.json  # 已处理信号记录
└── src/
    ├── api.js                 # API访问模块
    ├── dataProcessor.js       # 数据处理模块
    ├── dingTalk.js            # 钉钉推送模块
    ├── storage.js             # 本地存储模块
    ├── schedule.js            # 定时任务模块
    └── index.js               # 主程序入口
```

## 安装使用

### 1. 克隆仓库

```bash
git clone https://github.com/huckhuck12/kol_robot.git
cd kol_robot
```

### 2. 安装依赖

```bash
npm install
```

### 3. 配置系统

编辑 `config.js` 文件，配置以下参数：

```javascript
module.exports = {
  // API配置
  api: {
    url: 'http://kol.zhixing.icu/api/user/proxy/frontend-messages',
    params: {
      type: 'all',
      limit: 100
    },
    // ...
  },

  // 钉钉机器人配置
  dingTalk: {
    webhook: '你的钉钉机器人webhook地址',
    secret: '你的钉钉机器人加签密钥'
  },

  // 定时任务配置（单位：分钟）
  schedule: {
    interval: 5
  },
  // ...
};
```

### 4. 启动系统

```bash
npm start
```

## 配置说明

### API配置

| 参数 | 说明 | 默认值 |
|------|------|--------|
| `url` | API地址 | `http://kol.zhixing.icu/api/user/proxy/frontend-messages` |
| `params.type` | 消息类型 | `all` |
| `params.limit` | 返回数量限制 | `100` |
| `headers` | 请求头配置 | 模拟浏览器请求头 |
| `retry.times` | 重试次数 | `3` |
| `retry.delay` | 重试间隔（毫秒） | `1000` |

### 钉钉机器人配置

| 参数 | 说明 |
|------|------|
| `webhook` | 钉钉机器人webhook地址 |
| `secret` | 钉钉机器人加签密钥 |

### 定时任务配置

| 参数 | 说明 | 默认值 |
|------|------|--------|
| `interval` | 执行间隔（分钟） | `5` |

## 钉钉消息格式

系统推送的钉钉消息包含以下信息：

- 👤 **KOL名称**：发布信号的分析师名称
- 📈 **交易对**：如 BTC/USDT、ETH/USDT 等
- ➡️ **方向**：多头或空头
- 🎯 **入场价**：建议的入场价格
- 🛑 **止损**：建议的止损价格
- 🎯 **目标价**：建议的目标价格
- 🔢 **杠杆**：建议的杠杆倍数
- 💡 **分析理由**：KOL的分析和理由
- ⏰ **时间**：信号发布时间
- 📢 **频道**：信号发布的频道

## 运行日志

系统启动后，会在控制台输出运行日志，包括：

```
============================================================
KOL交易信号推送系统
============================================================
✅ 配置检查完成
[2025/12/23 16:29:18] 开始执行任务...
定时任务已启动，每5分钟执行一次
✅ 应用已启动
📅 定时任务：每5分钟执行一次
🔔 等待新的交易信号...
============================================================
提取到16个有效信号
✅ 钉钉推送成功：Sherlock - BERA
✅ 钉钉推送成功：山寨之王 - 芷楹
...
[2025/12/23 16:29:37] 任务执行完成
```

## 注意事项

1. **API限制**：API可能有访问频率限制，建议不要将执行间隔设置得太短
2. **钉钉机器人配置**：请确保钉钉机器人的webhook和密钥正确配置
3. **依赖版本**：建议使用指定版本的依赖包，避免兼容性问题
4. **日志监控**：定期查看日志，确保系统正常运行

## 常见问题

### Q: 为什么没有收到钉钉推送？
A: 请检查以下几点：
1. 钉钉机器人的webhook和密钥是否正确配置
2. 是否有新的交易信号（系统只推送新信号）
3. 查看日志是否有错误信息

### Q: 如何修改定时任务间隔？
A: 在`config.js`文件中修改`schedule.interval`参数，单位为分钟

### Q: 如何添加更多的KOL？
A: 系统会自动从API获取所有KOL的信号，无需手动添加

## 许可证

ISC

## 贡献

欢迎提交Issue和Pull Request！
